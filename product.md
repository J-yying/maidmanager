
-----

# 项目名称：店铺内部管理系统 (MaidManager MVP)

**版本号：** V1.0
**适用端：** 1.  **PC Web端**（主要用于投资人看报表、店长排班）
2\.  **移动 Web端**（主要用于店长拿着手机走动式开单、查看房态）

-----

## 1\. 项目背景与目标

  * **背景：** 当前店铺采用人工记录排班与营收，存在“排班冲突难发现”、“薪资计算复杂易出错”、“经营状况不透明”三大痛点。
  * **目标：** 建立一套轻量级的SaaS管理系统，实现“排班可视化”、“开单自动化”、“薪资自动算”，让店长由繁入简，让投资人账目清晰。
  * **核心原则：** 收付实现制（无储值）、单向录入（仅店长操作）、薪资快照（每单锁定提成）。

-----

## 2\. 角色与权限体系

| 角色 | 核心职责 | 权限范围 |
| :--- | :--- | :--- |
| **店长 (Manager)** | 现场运营、录入数据 | 1. 员工档案管理（录入/修改）<br>2. 排班管理（设定工作时段）<br>3. 订单管理（开单/结账/取消）<br>4. 查看今日/历史订单流水 |
| **投资人 (Investor)** | 财务审批、经营监控 | 1. 拥有店长所有权限<br>2. **薪资规则配置**（底薪/提成点位）<br>3. **财务报表查看**（营收/毛利/工资条）<br>4. 店铺成本录入（房租/水电） |

-----

## 3\. 核心业务流程

### 3.1. 基础配置流程

1.  **员工入职：** 投资人/店长录入员工姓名、电话。
2.  **定薪（关键）：** 投资人设定该员工的薪资模板。
      * *模板规则：* 底薪（元/月） + 提成比例（%）。
      * *例：* 小爱 = 底薪3000 + 提成40%。

### 3.2. 日常运营流程 (店长视角)

1.  **排班 (每日/每周)：** 店长与女仆沟通后，在系统“拖拽”或“录入”该女仆的**可服务时间段**（如：2023-11-19 14:00-22:00）。
2.  **接客/开单：**
      * 客人到店，店长查询“当前空闲人员”。
      * 选择女仆 -\> 输入客户名（如“王总”）-\> 选择时长 -\> 确认金额 -\> **系统生成订单**。
3.  **服务结束：** 服务自动结束（或手动点击），状态归档。

### 3.3. 结算流程 (投资人视角)

1.  **日结/月结：** 系统自动汇总：`总营收 - (员工提成+底薪) - 固定成本 = 净利`。
2.  **发薪：** 月底生成《工资单》，投资人核对无误后线下打款，并在系统点击“标记已发”。

-----

## 4\. 功能需求详情 (Functional Requirements)

### 模块一：人员与薪资管理 (Staff & Salary)

  * **F1.1 员工列表：** 展示所有在职/离职员工。
  * **F1.2 薪资配置：**
      * 支持字段：`基础底薪(Base Salary)`、`提成比例(Commission Rate)`。
      * *业务规则：* 修改薪资规则**仅对新订单生效**，不影响历史订单的提成计算。

### 模块二：智能排班 (Smart Roster)

  * **F2.1 时间轴排班：**
      * 输入：选择员工、日期、开始时间、结束时间。
      * 展示：以甘特图/时间条形式展示当日所有人的班次。
  * **F2.2 排班调整与校验：**
      * 允许修改起止时间（如加班/早退）。
      * *校验规则：* 如果缩短排班时间（如22:00改为20:00），系统必须检查 **20:00-22:00期间是否存在已预约订单**。若存在，禁止修改并报错。

### 模块三：业务开单 (Order Processing) —— **系统核心**

  * **F3.1 可用性查询 (Availability Check)：**
      * 在开单页面，输入`开始时间`和`时长`，系统自动筛选出满足以下条件的女仆：
        1.  **在班：** 订单时间在排班时段内。
        2.  **空闲：** 订单时间与该女仆已有的订单**无重叠**。
  * **F3.2 订单录入：**
      * 字段：`客户名称`(支持模糊匹配历史客户)、`服务项目`、`实收金额`、`支付方式`。
  * **F3.3 薪资快照 (Commission Snapshot)：**
      * *核心逻辑：* 订单创建瞬间，系统读取该员工当前的`提成比例`，计算出`提成金额`，并写入订单表。
      * *目的：* 即使下个月员工涨薪，回查上个月的订单提成数额依然准确。

### 模块四：财务驾驶舱 (Finance Dashboard)

  * **F4.1 工资条生成：**
      * 公式：`应发工资 = 设定底薪 + Σ(本月所有订单的提成快照金额)`。
      * 支持查看明细：点击工资条可展开查看该员工本月做的每一单详情。
  * **F4.2 经营报表：**
      * **总流水：** 统计所有订单的`实收金额`。
      * **毛利预估：** `总流水 - Σ(订单提成) - 房租/水电(手工录入)`。
  * **F4.3 客户简报 (CRM Lite)：**
      * 按`客户名称`分组，统计消费总额和来店次数，生成“高价值客户榜单”。

-----

## 5\. 非功能性需求 (NFR)

1.  **数据一致性：** 严禁“撞单”。在并发情况下（虽然店长可能就一个人，但为了逻辑严密），数据库层面需保证同一女仆在同一时间段只能有一条有效订单。
2.  **易用性：** 移动端开单操作必须在 **3步/15秒** 内完成。
3.  **隐私性：** 员工薪资数据仅对有“投资人”权限的账号可见。

-----

## 6\. 核心业务逻辑示例 (Business Logic Case)

**场景：早退冲突检测**

  * **前提：** 女仆A排班为 `14:00 - 22:00`。
  * **现状：** 已经有一个订单是 `21:00 - 22:00`。
  * **操作：** 店长试图将女仆A的排班修改为 `14:00 - 20:00` (早退)。
  * **系统判定：**
    1.  查询女仆A在 `20:00 - 22:00` (被切掉的时间段) 是否有订单？
    2.  结果：发现有订单 (21:00-22:00)。
    3.  **动作：** 拦截请求，弹窗提示“该时段已有预约，请先取消订单”。

-----
