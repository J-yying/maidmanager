# MaidManager PRD（店长视角）

## 1. 项目背景
面向上钟类服务店铺（美容、按摩、养生、陪练等），提供员工/套餐/排班/预约（含续钟）/结算全流程管理，以及支出与财务概览，重点解决排班与预约冲突、服务过程记录不全、财务分项不清的问题。

## 2. 用户与场景（店长）
1) **套餐配置**
   - 目标：定义服务时长与价格，作为预约和续钟的基线；设置默认提成（元）。
2) **员工管理**
   - 目标：维护员工入职/离职状态，设置提成方式。比例提成按百分比录入；固定金额可按套餐单独配置或沿用套餐默认值。
3) **排班管理**
   - 目标：为每天安排员工排班，避免同日同员工重复；可编辑时间；可复制其他日期排班到今天；需要支持删除排班（若当日存在未取消预约/订单，则需先取消；当日有进行中/已完成的订单时不可删）。
4) **预约与服务流转**
   - 目标：完成预约→开始/续钟→结束→结算的全链路，并在时间轴上清晰呈现在班/待开始/进行中/已完成状态。
5) **支出与财务**
   - 目标：记录日常支出（如房租水电等固定成本、日常消耗）；提供工资条和财务总览，为后续细分（固定成本/人员成本）做准备。

## 3. 工作流程（模块拆分）
### 3.1 固定配置（套餐、员工）
- 套餐：设置名称、时长、价格、默认提成。
- 员工：新增/编辑员工，录入电话、状态（在职/离职）、提成类型与数值；可进入套餐提成弹窗为单人配置套餐固定提成。

### 3.2 按天管理（排班）
- 创建/编辑：同账号同员工同日仅一条；可修改开始/结束时间。
- 复制：支持将某日排班复制到目标日（如复制到今天）。
- 删除：仅当该员工当日无未取消的预约/订单时允许；若存在进行中/已完成/待开始订单则需先取消预约再删除。
- 时间轴：按当日最早/最晚排班动态缩放，底层显示在班时段。

### 3.3 预约与服务
- 预约创建：选择开始时间与套餐，查询可用员工（避开非取消订单重叠），创建预约（待开始）。
- 时间轴展示：在班（浅绿）底层；待开始（黄）、进行中/待结算（橙红）、已完成（蓝）覆盖在上层，刻度随排班动态。
- 开始：录入实际开始/预计结束，状态改为进行中。
- 续钟：选择套餐续钟，自动延长结束时间，累加实收与备注；若与后续预约重叠则拒绝。
- 结束：录入实际结束；若结束时间≤开始时间则自动取消释放时间；否则转为待结算。
- 结算：可调整实际开始/结束、实收金额、支付方式，状态改为已完成；当日已完成列表仅查看，历史编辑在历史订单中进行。

### 3.4 支出
- 录入：日期、标题、金额、备注；表单重置便于连续录入。
- 列表：按月查看、编辑、删除（删除需确认）；可作为固定成本、日常消耗的基础记录。

### 3.5 财务
- 工资条：按月汇总底薪 + 提成。
+- 财务总览：按月汇总营收、提成、底薪、支出、净利润（可进一步细分固定成本/人员成本）。

## 4. 业务规则
- 数据隔离：所有数据带 `owner`，接口按账号过滤。
- 排班唯一与删除：owner+日期+员工唯一；删除前需无未取消订单，否则拒绝。
- 时间校验：预约/续钟不得与非取消订单重叠（分钟级）。
- 状态流转：pending → in_progress → finished → completed；任意阶段可取消。
- 结束校验：结束时间≤开始时间时自动取消释放占用。
- 续钟：延长结束、累加金额/备注；冲突则失败。
- 提成：比例用小数存储（UI 百分比输入），固定金额可按套餐单独配置。

## 5. 前端时间轴说明
- 刻度：根据当日排班最早/最晚时间自动缩放，步长 1 小时标记。
- 颜色分层：在班（浅绿）、待开始（黄）、进行中/待结算（橙红）、已完成（蓝）；上层覆盖下层。
- 交互：时间选择支持任意分钟；预约创建/开始/续钟/结束/结算会实时刷新时间轴和订单列表。
